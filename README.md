# Методи масштабування реляційних баз даних

Масштабування реляційних баз даних грає важливу роль у забезпеченні продуктивності та доступності систем з великою навантаженістю. Існує кілька підходів до цього: реплікація Master/Slave та Master/Master, функціональне та горизонтальне партиціювання, шардинг, денормалізація. У цій статі я хочу Вам розповісти про переваги та недоліки кожного цього підходу. Також розповім нюанси та наведу кейси використання, коли вони будуть працювати якнайкраще.

## Реплікація 

Реплікація в базі даних - це процес створення та підтримки копій даних з одного джерела на інших місцях. Це може бути корисним для забезпечення високої доступності та підвищення продуктивності. Існують різні види реплікації, такі як Master/Slave (одне головне джерело, багато копій), Master/Master (декілька джерел, які можуть приймати та змінювати дані), та інші.

### Master/Slave

Метод Master/Slave в контексті баз даних передбачає існування одного головного джерела (Master), яке має основний набір даних, і кількох слуг (Slave), які мають копії цих даних і синхронізуються з мастером. Мастер відповідає за запис даних, тоді як слейви використовуються для читання або резервних копій. Цей підхід може полегшити навантаження на мастера, оскільки читання можна розподілити між кількома слейвами. Проте, це також може виникнути питання синхронізації між мастером і слейвами, а також управлінням конфліктами даних у випадку одночасних змін.

![](./resource/masterSlave.png)

Уявіть магазин електроніки з онлайн-магазином та фізичними магазинами. Основна база даних знаходиться в центральному офісі (Master), але дані про товари, клієнтів, замовлення та запаси потрібні і в фізичних магазинах. Кожен магазин може мати свою локальну копію цих даних (Slave), які регулярно синхронізуються з центральною базою.

Коли клієнт робить покупку в онлайн-магазині, дані про замовлення зберігаються у центральній базі даних (Master), а фізичні магазини можуть отримати цю інформацію через синхронізацію зі слейвами. Таким чином, клієнти можуть перевірити наявність товару в найближчому магазині, оскільки дані про запаси також синхронізуються між магазинами та центральною базою.

Це дозволяє магазинам оперативно взаємодіяти зі своїми клієнтами та мається на увазі, що зміни, які відбуваються в будь-якому місці (онлайн чи фізичний магазин), відображаються в центральній базі даних та інших місцях завдяки реплікації Master/Slave.

|  Переваги                                                                                                                                      |   Недоліки  |
| -----------                                                                                                                                    | ----------- | 
| **Висока доступність:** Через те, що читання може розподілятись між кількома слейвами, цей метод забезпечує швидкий доступ до даних для читання.| **Одноманітність даних:** Існує можливість, що під час синхронізації деякі дані на слейвах можуть відрізнятися від мастера, що може призвести до втрати консистентності.           |
| **Резервне копіювання:** Слейви можуть служити як резервні копії, дозволяючи відновити дані у випадку втрати основної бази.                     | **Витрати на обслуговування:** Підтримка і управління кількома копіями даних (Slave) може потребувати додаткових зусиль і ресурсів.          |
| **Розподіл навантаження:** Можливість розподілу навантаження на читання дозволяє зменшити навантаження на мастер для операцій запису.          |             |
| **Простота налаштування:** порівняно з Master/Master реплікацією, Master/Slave є простішою в налаштуванні та управлінні.                       |             |
| Конфлікти відсутні завдяки тому, що тільки один сервер бази даних (Master) обробляє та здійснює записи.                                        |             |

### Master/Master

Master/Master архітектура баз даних означає наявність кількох серверів (мастерів), які мають право на запис та зміну даних. Це означає, що кожен має здатність приймати та виконувати як операції читання, так і запису даних. Такий підхід може бути корисним для забезпечення високої доступності та витривалості системи. Проте, він потребує уважного управління конфліктами та синхронізацією даних між мастерами, оскільки одні й ті ж дані можуть змінюватись на різних серверах у той самий час.

![](./resource/masterMaster.png)

Уявіть ситуацію з системою онлайн-аукціону, де кілька серверів баз даних працюють у режимі Master/Master.

Кожен з цих серверів баз даних має можливість приймати та обробляти пропозиції та ставки в реальному часі від користувачів. Наприклад, якщо один користувач робить ставку на певний лот, ця інформація має бути оновлена на всіх серверах, щоб уникнути перескочення ставок.

У такій системі, якщо обидва сервери можуть приймати та обробляти ставки, то користувачі можуть брати участь у торгах та робити ставки як на одному сервері, так і на іншому. Синхронізація між цими серверами є ключовою, щоб забезпечити консистентність даних, уникнути перескочення ставок та зберегти цілісність процесу торгівлі.

|  Переваги                                                                          |   Недоліки  |
| -----------                                                                        | ----------- | 
| **Висока доступність:** Кожен сервер може приймати запити, що забезпечує високий рівень доступності системи. Якщо один сервер вийде з ладу, інший може продовжувати обробку запитів. | **Конфлікти при записі:** Одночасні зміни на різних серверах можуть призвести до конфліктів при синхронізації даних, що потребує уважного управління конфліктами та розв'язання проблем з цілісністю даних.   |
| **Розділення навантаження:** Навантаження на операції запису та читання може бути розподілене між серверами, що дозволяє оптимізувати використання ресурсів. | **Синхронізація та консистентність:** Забезпечення консистентності даних між серверами є складним завданням, і неправильна синхронізація може призвести до втрати консистентності.   |
| **Скалінг:** Ця архітектура може бути легше масштабована горизонтально, додаючи нові сервери для збільшення продуктивності та витривалості. | **Складність налаштування та підтримки:** Налаштування та управління Master/Master конфігурацією може бути складним завданням, вимагаючи високого рівня експертизи для оптимального функціонування системи.   |
|                                                                                                                                       | **Безпека:** декілька серверів баз даних можуть вносити зміни в дані, це може збільшити потенційні напрямки для атак.  |



Спільні недоліки реплікації для Master/Slave і Master/Master: 


### Функціональне партиціювання

Функціональне партиціювання - це стратегія, коли дані розділяються на частини (партиції) відповідно до функцій, які вони виконують або за допомогою конкретного критерію розподілу. Цей підхід дозволяє оптимізувати роботу з великими обсягами даних шляхом розділення їх на менші і більш керовані частини.

Функціональне партиціювання може бути застосоване до різних компонентів даних: можливо, розділити дані за часом, регіоном, типом користувачів чи іншими параметрами, що дозволяє підвищити продуктивність та масштабованість системи.

Цей підхід дозволяє оптимізувати запити та операції для кожної партиції, зменшуючи навантаження на кожну окрему частину бази даних та полегшуючи роботу з ними.

![](./resource/funcpart.png)

Звичайний приклад функціонального партиціювання можна побачити в системі управління користувачами. Допустимо, у великій системі соціальних мереж є мільйони користувачів з різних регіонів світу.

Функціональне партиціювання може бути використане для розділення користувачів за регіонами. Дані про користувачів з Азії можуть бути збережені в одній частині бази даних, тоді як дані європейських користувачів - в іншій. Це розділення дозволяє оптимізувати роботу з даними для конкретного регіону: запити, пов'язані з користувачами з певної частини світу, обробляються локально відносно цієї частини бази даних.

Такий підхід дозволяє зменшити час відповіді на запити, оскільки дані про користувачів можуть бути розподілені на різні сервери в залежності від їхнього місця проживання. Також це полегшує масштабування системи, оскільки можна легко додавати чи видаляти сервери, що відповідають за конкретні регіони, в залежності від зростання користувацької бази

|  Переваги                                                                          |   Недоліки  |
| -----------                                                                        | ----------- | 
| **Підвищена продуктивність:** Розділення даних за функціональними або логічними критеріями дозволяє оптимізувати запити та операції для кожної партиції, зменшуючи час відповіді на запити. | **Складність управління:** Розділення даних може зробити управління системою більш складним, оскільки потребує уваги до організації та управління кожною партицією.   |
| **Ефективне управління обсягами даних:** Функціональне партиціювання спрощує роботу з великими обсягами даних, дозволяючи розділити їх на менші та керовані частини.  | **Ризик втрати консистентності:** Розділення даних може призвести до складнощів у забезпеченні консистентності між різними частинами бази даних, що може призвести до проблем з цілісністю та узгодженістю даних. |
| **Збільшення масштабованості системи:** Дозволяє легко масштабувати систему, додаючи нові партиції або сервери для збільшення продуктивності. | **Потреба у додаткових ресурсах:** Для ефективної роботи з розділеними даними може знадобитися більше ресурсів на управління та підтримку інфраструктури бази даних.|


























|  Переваги                                                                          |   Недоліки  |
| -----------                                                                        | ----------- | 
| Ячейка 3                                                                           | Ячейка 4   |
| Ячейка 3                                                                           | Ячейка 4   |





